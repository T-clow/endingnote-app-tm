<% if @insurance_policy.errors.any? %>
  <div id="error_explanation">
    <ul>
    <% @insurance_policy.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
    </ul>
  </div>
<% end %>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h2>保険証券を編集</h2>
        </div>
        <div class="card-body">
          <%= form_with(model: [@user, @insurance_policy], local: true) do |form| %>
            <div class="form-group">
              <%= form.label :policy_number, '証券番号(ご不明な場合は空欄で登録ください)' %>
              <%= form.text_field :policy_number, class: 'form-control' %>
            </div>
            <div class="form-group">
              <%= form.label :insurance_company, '保険会社' %>
              <%= form.text_field :insurance_company, list: "insurance_company_list", class: "form-control" %>
              <datalist id="insurance_company_list">
                <% InsurancePolicy::INSURANCE_COMPANIES.each do |company| %>
                  <option value="<%= company %>"></option>
                <% end %>
              </datalist>
            </div>
            <div class="form-group">
              <%= form.label :insurance_type, '保険の種類' %>
              <%= form.text_field :insurance_type, list: "insurance_type_list", class: "form-control" %>
              <datalist id="insurance_type_list">
                <% InsurancePolicy::INSURANCE_TYPES.each do |type| %>
                  <option value="<%= type %>"></option>
                <% end %>
              </datalist>
            </div>
            <div class="form-group">
              <%= form.label :insurance_amount, '保険金額（万円）' %>
              <%= form.text_field :insurance_amount, value: @insurance_policy.insurance_amount / 10000, class: 'form-control' %>
            </div>
            <div class="form-group">
              <%= form.label :insurance_period, '保険期間（年齢で入力または終身を選択）' %>
              <%= form.text_field :insurance_period, value: (@insurance_policy.insurance_period == 100 ? "終身" : @insurance_policy.insurance_period), list: "insurance_period_options", class: "form-control" %>
              <datalist id="insurance_period_options">
                <% InsurancePolicy.insurance_period_options(@user.birthday.age).each do |option, value| %>
                  <option value="<%= option %>"><%= option %></option>
                <% end %>
              </datalist>
            </div>
            <div class="form-group">
              <%= form.label :policy_image, "証券画像" %>
              <%= form.file_field :policy_image, class: 'form-control' %>
            </div>
            <div class="form-group">
              <%= form.label :note, "備考" %>
              <%= form.text_area :note, class: 'form-control' %>
            </div>
            <div class="actions mt-4">
              <%= form.submit "登録する", class: "btn btn-primary w-100", data: { turbo: "false" } %>
            </div>
          <% end %>
          <%= button_to '削除', user_insurance_policy_path(@user, @insurance_policy), method: "delete", form: { data: { turbo_confirm: "削除しますか？" } }, class: "btn btn-danger mt-3 w-100" %>
          <%= link_to '詳細へ', user_insurance_policy_path(@user, @insurance_policy), class: 'btn btn-info mt-3 w-100' %>
          <%= link_to '一覧に戻る', user_insurance_graphs_path(current_user), class: "btn btn-secondary mt-3 w-100", data: { turbo: false } %>
        </div>
      </div>
    </div>
  </div>
</div>
